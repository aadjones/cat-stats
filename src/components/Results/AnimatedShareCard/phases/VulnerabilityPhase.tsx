import { useState, useEffect } from 'react';
import type { PhaseComponentProps } from '../types';

export function VulnerabilityPhase({
  characterSheet,
  isActive,
  isVisible,
}: PhaseComponentProps) {
  const [showWarning, setShowWarning] = useState(false);
  const [showVulnerability, setShowVulnerability] = useState(false);
  const [flashScreen, setFlashScreen] = useState(false);

  useEffect(() => {
    if (!isActive) {
      setShowWarning(false);
      setShowVulnerability(false);
      setFlashScreen(false);
      return;
    }

    // Screen flash immediately
    setFlashScreen(true);

    // Show warning after 0.3s
    const warningTimer = setTimeout(() => {
      setShowWarning(true);
    }, 300);

    // Show vulnerability after 1.5s
    const vulnerabilityTimer = setTimeout(() => {
      setShowVulnerability(true);
    }, 1500);

    // Remove flash after 0.6s
    const flashTimer = setTimeout(() => {
      setFlashScreen(false);
    }, 600);

    return () => {
      clearTimeout(warningTimer);
      clearTimeout(vulnerabilityTimer);
      clearTimeout(flashTimer);
    };
  }, [isActive]);

  if (!isVisible) return null;

  const weakness = characterSheet.characterData.weakness;

  return (
    <>
      {/* Screen flash overlay */}
      {flashScreen && (
        <div className="fixed inset-0 bg-red-500/30 vulnerability-flash pointer-events-none z-10" />
      )}

      <div className="vulnerability-section text-center">
        {/* Warning phase */}
        {showWarning && (
          <div className="mb-6 animate-in">
            <div className="text-6xl mb-4 animate-pulse">⚠️</div>
            <h3 className="text-red-400 text-2xl font-bold animate-pulse">
              CRITICAL WEAKNESS DETECTED
            </h3>
          </div>
        )}

        {/* Vulnerability reveal */}
        {showVulnerability && (
          <div className="animate-in">
            <div className="bg-red-900/40 border-2 border-red-500/60 rounded-lg p-6 mx-4">
              <h4 className="text-red-300 text-lg font-bold mb-3">
                {weakness.name}
              </h4>
              <p className="text-red-100 text-sm leading-relaxed">
                {weakness.description}
              </p>
            </div>
          </div>
        )}
      </div>
    </>
  );
}
