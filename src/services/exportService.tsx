import { pdf } from '@react-pdf/renderer';
import type { CharacterSheet } from '../core/personality/types';
import { CharacterSheetPDF } from '../components/PDF';

export function generateTextExport(characterSheet: CharacterSheet): void {
  const { characterData, stats, petName } = characterSheet;

  const textContent = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           CATSTATS                            â•‘
â•‘                    FELINE LEGEND CHARACTER SHEET             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£

ğŸ± NAME: ${petName.toUpperCase()}
ğŸ† ARCHETYPE: ${characterData.archetype}

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        CORE ATTRIBUTES                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Wisdom...................................... ${stats.wisdom.toString().padStart(3)} â•‘
â•‘ Cunning..................................... ${stats.cunning.toString().padStart(3)} â•‘
â•‘ Agility..................................... ${stats.agility.toString().padStart(3)} â•‘
â•‘ Stealth..................................... ${stats.stealth.toString().padStart(3)} â•‘
â•‘ Charisma.................................... ${stats.charisma.toString().padStart(3)} â•‘
â•‘ Resolve..................................... ${stats.resolve.toString().padStart(3)} â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš”ï¸  COMBAT MOVES:
${characterData.combatMoves
  .map(
    (ability) =>
      `â€¢ ${ability.name}\n  ${ability.stats}\n  ${ability.description}\n`
  )
  .join('')}

ğŸŒ ENVIRONMENTAL POWERS:
${characterData.environmentalPowers
  .map(
    (ability) =>
      `â€¢ ${ability.name}\n  ${ability.stats}\n  ${ability.description}\n`
  )
  .join('')}

ğŸ’¬ SOCIAL SKILLS:
${characterData.socialSkills
  .map(
    (ability) =>
      `â€¢ ${ability.name}\n  ${ability.stats}\n  ${ability.description}\n`
  )
  .join('')}

ğŸ”® PASSIVE TRAITS:
${characterData.passiveTraits
  .map(
    (ability) =>
      `â€¢ ${ability.name}\n  ${ability.stats}\n  ${ability.description}\n`
  )
  .join('')}

âš ï¸  CRITICAL VULNERABILITY:
â€¢ ${characterData.weakness.name}
  ${characterData.weakness.description}

ğŸ•’ SITUATIONAL MODIFIERS:
${characterData.timeModifiers
  .map((modifier) => `â€¢ ${modifier.name}: ${modifier.effect}\n`)
  .join('')}

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    Generated by CatStats                     â•‘
â•‘                  Turn your pet into a legend!                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;

  // Create and download as a text file
  const blob = new Blob([textContent], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${petName}-CatStats-Legend.txt`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);

  alert(
    `âœ¨ ${petName}'s character sheet downloaded! Perfect for printing or sharing.`
  );
}

export async function generatePdfExport(
  characterSheet: CharacterSheet,
  characterId?: string | null
): Promise<void> {
  const { petName } = characterSheet;

  // Generate PDF blob using React-PDF
  const blob = await pdf(
    <CharacterSheetPDF
      characterSheet={characterSheet}
      characterId={characterId}
    />
  ).toBlob();

  // Download the PDF
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${petName}-CatStats-Legend.pdf`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
}
